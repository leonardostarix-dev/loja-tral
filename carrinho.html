<!doctype html>
<html>
  <head>
    <link rel="stylesheet" href="css/style.css" />
  </head>
  <body>
    <h1>Carrinho</h1>
    <div id="cart-items"></div>
    <h2 id="total"></h2>
    <button onclick="finalizar()">Finalizar Compra</button>

    <script src="js/api.js"></script>
    <script src="js/carrinho.js"></script>
    <script>
      function renderCart() {
        const cart = getCart();
        const container = document.getElementById("cart-items");
        let total = 0;

        cart.forEach((item) => {
          total += Number(item.preco);
          container.innerHTML += `
            <p>${item.nome} - R$ ${item.preco}</p>
        `;
        });

        document.getElementById("total").innerText = "Total: R$ " + total;
      }

      async function finalizar() {
        const cart = getCart();

        const itens = cart.map((item) => ({
          id: item.id,
          nome: item.nome,
          preco: item.preco,
          qtd: 1,
        }));

        await fetch(API_URL, {
          method: "POST",
          body: JSON.stringify({
            action: "pedido",
            itens: itens,
          }),
        });

        localStorage.removeItem("cart");
        alert("Pedido realizado com sucesso!");
        location.reload();
      }

      renderCart();
    </script>
  </body>
</html>
